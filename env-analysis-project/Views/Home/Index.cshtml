@{
    ViewData["Title"] = "Dashboard";
}

<div class="w-full container mx-auto p-4 text-xs">
    <!-- 🔹 Giảm toàn bộ font xuống text-xs -->
    <!-- ========== Water Quality Section ========== -->
    <div class="mb-8">
        <div class="flex items-center mb-2">
            <p class="font-semibold mr-10 text-gray-600">Water Quality Parameters:</p>
            <select class="w-64 mr-8 pr-4 bg-white py-2 font-semibold text-gray-600 border border-gray-300 rounded-lg shadow-sm pl-2 text-xs">
                <option value="temperature">Temperature Chart</option>
                <option value="ph">pH Chart</option>
                <option value="color">Color Chart</option>
                <option value="bod5">BOD5 (20°C) Chart</option>
                <option value="cod">COD Chart</option>
                <option value="tss">Total Suspended Solids (TSS) Chart</option>
                <option value="arsenic">Arsenic (As) Chart</option>
                <option value="mercury">Mercury (Hg) Chart</option>
                <option value="lead">Lead (Pb) Chart</option>
                <option value="cadmium">Cadmium (Cd) Chart</option>
                <option value="chromium6">Chromium (VI) Chart</option>
                <option value="chromium3">Chromium (III) Chart</option>
                <option value="copper">Copper (Cu) Chart</option>
                <option value="zinc">Zinc (Zn) Chart</option>
                <option value="nickel">Nickel (Ni) Chart</option>
                <option value="manganese">Manganese (Mn) Chart</option>
                <option value="iron">Iron (Fe) Chart</option>
                <option value="oilgrease">Mineral Oil and Grease Chart</option>
                <option value="fluoride">Fluoride (F⁻) Chart</option>
                <option value="chloride">Chloride (Cl⁻) Chart</option>
                <option value="residualchlorine">Residual Chlorine Chart</option>
                <option value="sulfide">Sulfide (S²⁻) Chart</option>
                <option value="ammonium">Ammonium (NH₄⁺) Chart</option>
                <option value="totalnitrogen">Total Nitrogen Chart</option>
                <option value="totalphosphorus">Total Phosphorus Chart</option>
                <option value="coliforms">Coliforms Chart</option>
            </select>
        </div>

        <!-- Chart -->
        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
            <div class="h-[250px] md:h-[300px]">
                <canvas id="chartTemp"></canvas>
            </div>
        </div>
    </div>

    <!-- ========== Air Emission Section ========== -->
    <div>
        <div class="flex items-center mb-2">
            <p class="font-semibold mr-10 text-gray-600">Air Emission Parameters:</p>
            <select class="w-64 mr-8 pr-4 bg-white py-2 font-semibold text-gray-600 border border-gray-300 rounded-lg shadow-sm pl-2 text-xs">
                <option value="flowrate">Flow Rate Chart</option>
                <option value="pressure">Pressure Chart</option>
                <option value="temperature">Temperature Chart</option>
                <option value="oxygen">Excess O₂ Chart</option>
                <option value="dust">Total Dust Chart</option>
                <option value="co">Carbon Monoxide (CO) Chart</option>
                <option value="nox">Nitrogen Oxides (NOx) Chart</option>
                <option value="so2">Sulfur Dioxide (SO₂) Chart</option>
            </select>
        </div>

        <!-- Chart -->
        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
            <div class="h-[250px] md:h-[300px]">
                <canvas id="chartFlow"></canvas>
            </div>
        </div>
    </div>
</div>
<script>
    const months = [
        '2025-01-01','2025-02-01','2025-03-01','2025-04-01','2025-05-01','2025-06-01',
        '2025-07-01','2025-08-01','2025-09-01','2025-10-01','2025-11-01','2025-12-01'
    ];

    // ===== Temperature data =====
    const datasetTemp = {
        label: "Temperature",
        unit: "°C",
        values: [21.5, 23.1, 26.8, 30.2, 32.1, 34.5, 35.0, 34.2, 31.7, 28.4, 25.0, 22.2],
        qc: 40
    };

    // ===== Flow Rate data =====
    const datasetFlow = {
        label: "Flow Rate",
        unit: "m³/h",
        values: [120, 135, 150, 160, 180, 175, 190, 185, 170, 165, 150, 130],
        qc: 200
    };

    function seriesFrom(arr) {
        return months.map((d, i) => ({ x: d, y: arr[i] }));
    }

    function createChart(ctxId, dataset) {
        new Chart(document.getElementById(ctxId).getContext('2d'), {
            type: 'line',
            data: {
                datasets: [{
                    label: dataset.label,
                    data: seriesFrom(dataset.values),
                    borderColor: "#1f77b4",
                    backgroundColor: "#1f77b4",
                    tension: 0.25,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let value = context.formattedValue;
                                return `Indicator: ${dataset.label}\nValue: ${value} ${dataset.unit}\nDate: ${context.label}\nStandard Limit: ${dataset.qc}`;
                            }
                        }
                    },
                    legend: { labels: { font: { size: 13 } } }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: { parser: 'yyyy-MM-dd', unit: 'month', displayFormats: { month: 'MMM' } },
                        title: { display: true, text: 'Month' }
                    },
                    y: {
                        title: { display: true, text: `${dataset.label} (${dataset.unit})` }
                    }
                }
            }
        });
    }

    createChart("chartTemp", datasetTemp);
    createChart("chartFlow", datasetFlow);
</script>
